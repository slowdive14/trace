---
type: troubleshooting
status: done
description: "가중치 기반 완료율 계산 시스템 구현"
created: 2026-02-02
modified: 2026-02-02
phase: resolved
---

# 문제
> 완료율이 단순 개수 비율로 계산되어, 중요 작업(하이라이트)과 계층 구조가 반영되지 않음

---

# 시도
- Obsidian Dataview 가중치 로직 분석
- 기존 parseTodos, calculateWeeklyStats 구조 파악

---

# 원인
- 기존 로직: `completed / total * 100` (단순 개수 비율)
- 하이라이트(`==text==`) 항목에 더 큰 비중 부여 필요
- 부모-자식 계층에서 부모 가중치를 자식에게 분배하는 로직 없음

---

# 해결
1. **TodoItem에 weight 필드 추가**: 하이라이트면 2, 아니면 1
2. **isHighlighted 함수**: `/==.*==/` 정규식으로 감지
3. **buildTaskTree 함수**: 들여쓰기 기반 부모-자식 트리 구축
4. **calculateWeightedCompletion 함수**: 재귀적으로 가중치 계산
   - 자식 없으면: 완료 시 weight 반환
   - 자식 있으면: 부모 weight를 자식 수로 나눠 분배
5. **calculateTotalWeightedRate 함수**: 최종 백분율 산출
6. 일일 완료율 및 주간 통계에 적용

---

# 관련 파일
- C:/Users/user/Downloads/trace/src/components/TodoTab.tsx

---

# 재발 방지
- 통계/비율 계산 시 가중치 고려 여부 먼저 확인
- 플랜 문서 작성 후 구현 진행

---

# 📝 쉬운 설명

### 문제
할일 완료율이 그냥 "몇 개 했나"만 세서 중요한 일과 덜 중요한 일이 똑같이 취급됨

### 원인
기존에는 10개 중 5개 완료하면 무조건 50%로 계산. 근데 중요한 일(하이라이트 표시된 것)을 완료했는지, 아니면 덜 중요한 일만 했는지 구분이 없었음

### 해결
- 중요한 일(==표시==)은 2배 점수
- 큰 일 밑에 작은 일들이 있으면, 큰 일의 점수를 작은 일들이 나눠 가짐
- 예: 중요한 일 1개 완료 + 보통 일 1개 미완료 = 66% (단순 계산은 50%)

### 관련 파일
- C:/Users/user/Downloads/trace/src/components/TodoTab.tsx
