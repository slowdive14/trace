---
type: troubleshooting
status: done
description: "레벨 완료 개수가 어제보다 줄어드는 버그"
created: 2026-02-02
modified: 2026-02-02
phase: resolved
---

# 문제
> 레벨 표시 (146/210 완료)가 어제보다 줄어들었음

---

# 시도
- TodoTab.tsx의 레벨 계산 로직 분석
- historyTodos 로드 범위 확인

---

# 원인
- `historyTodos`가 **최근 30일(29일)만** 로드 (`subDays(logicalToday, 29)`)
- `calculateTotalCompleted()`가 `historyTodos`를 사용하여 완료 개수 계산
- 시간이 지나면 오래된 완료 항목이 30일 범위에서 벗어나 개수 감소

---

# 해결
- `firestore.ts`에 `getAllTodos()` 함수 추가 (날짜 필터 없이 전체 조회)
- `TodoTab.tsx`에 `allTodos` state 추가
- `calculateTotalCompleted()`가 `allTodos`를 사용하도록 변경

---

# 관련 파일
- C:/Users/user/Downloads/trace/src/services/firestore.ts
- C:/Users/user/Downloads/trace/src/components/TodoTab.tsx

---

# 재발 방지
- 레벨/경험치 등 누적 통계는 전체 기간 데이터를 조회해야 함
- 히스토리(제한된 기간)와 통계용 데이터를 분리하여 관리

---

# 📝 쉬운 설명

### 문제
레벨에 표시되는 완료 개수가 하루 지났는데 오히려 줄어들었음

### 원인
완료 개수를 세는데 최근 30일치만 보고 있어서, 30일 전에 완료한 항목들이 계산에서 빠짐. 마치 가계부를 최근 한 달치만 보면서 "총 지출"이라고 말하는 것과 같음.

### 해결
전체 기록을 따로 불러와서 완료 개수를 세도록 변경함

### 관련 파일
- C:/Users/user/Downloads/trace/src/services/firestore.ts
- C:/Users/user/Downloads/trace/src/components/TodoTab.tsx
